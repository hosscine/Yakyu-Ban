<!DOCTYPE html>
<html>

<head>
	<title>EaselJS demo: Inheritance</title>
	<script src="https://code.createjs.com/createjs-2015.11.26.min.js"></script>
	<script src="Ground.js"></script>
	<script src="Ball.js"></script>
	<script src="Pitcher.js"></script>
	<link href="css/style.css" rel="stylesheet" type="text/css" media="all" />

	<script>
		let stage // 絶対init内でinitizalizeする
		let ball
		let ground
		let pitcher

		function init() {

			let queue = new createjs.LoadQueue(false)
			queue.addEventListener("fileload", handleFileLoad)
			queue.addEventListener("complete", handleComplete)
			queue.loadManifest([{
					id: "ball",
					src: "assets/ball.png"
				},
				{
					id: "head",
					src: "assets/head.png"
				},
				{
					id: "body",
					src: "assets/head.png"
				}
			])
			stage = new createjs.Stage("Canvas")
			stage.addEventListener("stagemousedown", function(event) {
				ball.throw(250, 250, 250, 600)
			})

			createjs.Ticker.addEventListener("tick", stage)

			pitcher = new Pitcher()

			ground = stage.addChild(new Ground())
			ground.x = 250
			ground.y = 450
			ground.scaleX = ground.scaleY = 0.7

			stage.update()
		}

		function handleFileLoad(event) {
			switch (event.item.id) {
				case "ball":
					ball = new Ball(new createjs.Bitmap(event.result)) //Bitmapに変換する
					stage.addChild(ball)
					break
				case "head":
					pitcher.headBitmap = new createjs.Bitmap(event.result)
					break
				case "body":
					pitcher.bodyBitmap = new createjs.Bitmap(event.result)
					break
			}
		}

		function handleComplete(event) {
			stage.update() //complete後にupdateする
		}
	</script>
</head>

<body onload="init();">
	<canvas id="Canvas" width="500" height="500">
		alternate content
	</canvas>
</body>

</html>
